[env]
'_'.file = { path = ".env" }
KUBECONFIG = "{{config_root}}/kubeconfig"
SOPS_AGE_KEY_CMD = "op read 'op://homelab/kube age key/password'"
TALOSCONFIG = "{{config_root}}/talos/clusterconfig/talosconfig"

LOCAL_FISH_COMPLETE_PATH = "{{config_root}}/.completions/fish"

[hooks.enter]
shell = "fish"
script = """
if not contains -- $LOCAL_FISH_COMPLETE_PATH $fish_complete_path
    set -p fish_complete_path $LOCAL_FISH_COMPLETE_PATH
end
"""

[hooks.leave]
shell = "fish"
script = """
set -l path_index (contains -i $LOCAL_FISH_COMPLETE_PATH $fish_complete_path)
and set -e fish_complete_path[$path_index]
"""

[hooks]
# fyi, this ALWAYS runs using `sh`
postinstall = "{{config_root}}/scripts/gen-completions.sh fish"

[tools]
"aqua:budimanjojo/talhelper" = "3.0.45"
"aqua:derailed/k9s" = "0.50.16"
"aqua:FiloSottile/age" = { version = "1.3.1", completions = false }
"aqua:fluxcd/flux2" = "2.7.5"
"aqua:getsops/sops" = { version = "3.11.0", completions = false }
"aqua:go-task/task" = { version = "3.46.4", completions = true, completion_flag = "--completion" }
"aqua:jqlang/jq" = { version = "1.8.1", completions = false }
"aqua:kubernetes/kubectl" = "1.34.3"
"aqua:siderolabs/talos" = "1.12.1"
"aqua:utkuozdemir/pv-migrate" = "2.2.1"
"aqua:helm/helm" = "4.0.4"
"aqua:helmfile/helmfile" = "1.2.3"
"aqua:kubernetes-sigs/kustomize" = "5.8.0"
"aqua:mikefarah/yq" = { version = "4.50.1", completions = false }
"aqua:cilium/cilium-cli" = "0.18.9"
"aqua:cloudflare/cloudflared" = { version = "2025.11.1", completions = false }
"github:grafana/mcp-grafana" = { version = "0.7.10", completions = false }
